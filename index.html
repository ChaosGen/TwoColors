<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Два цвета</title>
    <style>
        :root {
            --p1-color: #FF007A; /* Розовый по умолчанию */
            --p2-color: #00E5FF; /* Голубой по умолчанию */
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #111;
        }

        /* Контейнер игры */
        #game-container {
            display: flex;
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        .player-zone {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: width 0.15s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            position: relative;
        }

        .player-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 2.5rem;
            font-weight: 900;
            pointer-events: none;
            text-transform: uppercase;
            text-align: center;
            padding: 20px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            display: block;
        }

        #player1 { background-color: var(--p1-color); width: 50%; }
        #player2 { background-color: var(--p2-color); width: 50%; }

        /* Кнопка выхода */
        #exit-btn {
            display: none;
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.4);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            font-size: 28px;
            line-height: 38px;
            text-align: center;
            cursor: pointer;
            z-index: 100;
        }

        /* Интерфейс настроек */
        #settings-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 25px;
            padding-bottom: 60px; /* Увеличен нижний отступ для удобной прокрутки на планшетах */
            border-radius: 30px;
            text-align: center;
            box-shadow: 0 25px 70px rgba(0,0,0,0.5);
            z-index: 200;
            width: 88%;
            max-width: 450px;
            max-height: 90vh; /* Немного уменьшил макс. высоту для лучшего контроля прокрутки */
            overflow-y: auto;
        }

        .config-section {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .player-config {
            flex: 1;
            background: #fdfdfd;
            padding: 12px;
            border-radius: 20px;
            border: 1px solid #eee;
        }

        .player-config input[type="text"] {
            width: 100%;
            border: 2px solid #eee;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 12px;
            box-sizing: border-box;
            font-size: 0.9rem;
            font-weight: bold;
            text-align: center;
        }

        /* Выбор цвета */
        .spectrum-label {
            font-size: 0.7rem;
            color: #888;
            margin-bottom: 4px;
            display: block;
            text-align: left;
        }

        .hue-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 18px;
            border-radius: 10px;
            background: linear-gradient(to right, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%);
            outline: none;
            cursor: pointer;
            margin-bottom: 8px;
        }

        /* Ползунок яркости для получения черного, серого и белого */
        .lightness-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 18px;
            border-radius: 10px;
            background: linear-gradient(to right, #000, #888, #fff);
            outline: none;
            cursor: pointer;
            margin-bottom: 12px;
        }

        .hue-slider::-webkit-slider-thumb, .lightness-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #fff;
            border: 3px solid #333;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* Сетка пресетов */
        .color-presets {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin-bottom: 10px;
        }

        .color-dot {
            width: 100%;
            aspect-ratio: 1/1;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: 0.1s;
        }
        .color-dot.active { border-color: #000; transform: scale(1.05); }

        /* Кастомный красивый ползунок кликов */
        .range-container {
            margin: 20px 0;
            text-align: left;
            padding: 0 10px;
        }

        .styled-range {
            -webkit-appearance: none;
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 10px;
            outline: none;
            margin: 15px 0;
        }

        .styled-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            background: #000;
            border-radius: 50%;
            cursor: pointer;
            border: 4px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }
        .styled-range::-webkit-slider-thumb:active { transform: scale(1.2); }

        .toggle-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            background: #f5f5f5;
            padding: 12px 18px;
            border-radius: 15px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider-round {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider-round:before {
            position: absolute;
            content: "";
            height: 18px; width: 18px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider-round { background-color: #4CAF50; }
        input:checked + .slider-round:before { transform: translateX(24px); }

        /* Кнопки */
        .btn-container { display: flex; flex-direction: column; gap: 12px; }
        button.main-btn {
            background: #000;
            color: white;
            border: none;
            padding: 16px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s;
        }
        button.main-btn:active { transform: scale(0.98); }
        button.secondary-btn {
            background: #f0f0f0;
            color: #333;
            border: none;
            padding: 12px;
            border-radius: 12px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        /* Экран победы */
        #victory-screen {
            display: none;
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            color: white;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 300;
            transition: background-color 0.5s ease;
        }

        #winner-text {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 30px;
            text-transform: uppercase;
            font-weight: 900;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
            padding: 0 20px;
        }
    </style>
</head>
<body>

    <button id="exit-btn" onclick="resetGame()">×</button>

    <div id="settings-overlay">
        <h2 style="margin-top:0; color: #111;">Настройки Битвы</h2>
        
        <div class="config-section">
            <!-- Игрок 1 -->
            <div class="player-config">
                <input type="text" id="name1" placeholder="Игрок 1" value="Игрок 1">
                <span class="spectrum-label">Тон и Яркость:</span>
                <input type="range" min="0" max="360" value="331" class="hue-slider" id="hue1" oninput="updateColorComplex(1)">
                <input type="range" min="0" max="100" value="50" class="lightness-slider" id="light1" oninput="updateColorComplex(1)">
                <div class="color-presets" id="presets1"></div>
            </div>
            <!-- Игрок 2 -->
            <div class="player-config">
                <input type="text" id="name2" placeholder="Игрок 2" value="Игрок 2">
                <span class="spectrum-label">Тон и Яркость:</span>
                <input type="range" min="0" max="360" value="187" class="hue-slider" id="hue2" oninput="updateColorComplex(2)">
                <input type="range" min="0" max="100" value="50" class="lightness-slider" id="light2" oninput="updateColorComplex(2)">
                <div class="color-presets" id="presets2"></div>
            </div>
        </div>

        <div class="toggle-group">
            <span style="font-weight: bold; color: #444;">Имена на экране</span>
            <label class="switch">
                <input type="checkbox" id="show-names-toggle" checked onchange="toggleLabelsPreview()">
                <span class="slider-round"></span>
            </label>
        </div>

        <div class="range-container">
            <label style="font-weight: bold; color: #555;">Сила клика: <span id="clicks-val">20</span></label>
            <input type="range" id="power-slider" min="2" max="200" value="20" class="styled-range">
        </div>

        <div class="btn-container">
            <button class="main-btn" onclick="startGame()">ИГРАТЬ</button>
            <button class="secondary-btn" id="fullscreen-btn" onclick="toggleFullscreen()">На весь экран</button>
        </div>
    </div>

    <div id="game-container">
        <div id="player1" class="player-zone" onclick="handlePress(1)">
            <div id="label1" class="player-label">Игрок 1</div>
        </div>
        <div id="player2" class="player-zone" onclick="handlePress(2)">
            <div id="label2" class="player-label">Игрок 2</div>
        </div>
    </div>

    <div id="victory-screen">
        <h1 id="winner-text">ПОБЕДА!</h1>
        <button class="main-btn" style="background: white; color: black; padding: 15px 60px;" onclick="resetGame()">В МЕНЮ</button>
    </div>

    <script>
        const brightColors = ['#FF0000', '#FFEB3B', '#4CAF50', '#00E5FF', '#9C27B0', '#FF007A', '#0000FF', '#FFFFFF', '#888888', '#000000'];
        const slider = document.getElementById('power-slider');
        const clicksDisplay = document.getElementById('clicks-val');
        
        let p1Color = '#FF007A';
        let p2Color = '#00E5FF';
        let p1Width = 50;
        let shiftPower = 2.5;
        let gameActive = false;

        function updateColorComplex(player) {
            const h = document.getElementById(`hue${player}`).value;
            const l = document.getElementById(`light${player}`).value;
            // Используем HSL для удобного получения любого оттенка, включая черный и белый
            const color = `hsl(${h}, 100%, ${l}%)`;
            
            const dummy = document.createElement('div');
            dummy.style.color = color;
            document.body.appendChild(dummy);
            const rgb = window.getComputedStyle(dummy).color;
            document.body.removeChild(dummy);
            
            if (player === 1) p1Color = rgb; else p2Color = rgb;
            document.documentElement.style.setProperty(`--p${player}-color`, rgb);
            document.getElementById(`presets${player}`).querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
        }

        function toggleLabelsPreview() {
            const show = document.getElementById('show-names-toggle').checked;
            document.getElementById('label1').style.display = show ? 'block' : 'none';
            document.getElementById('label2').style.display = show ? 'block' : 'none';
        }

        function setupPresets() {
            [1, 2].forEach(num => {
                const container = document.getElementById(`presets${num}`);
                brightColors.forEach(color => {
                    const dot = document.createElement('div');
                    dot.className = 'color-dot';
                    dot.style.backgroundColor = color;
                    if ((num === 1 && color === '#FF007A') || (num === 2 && color === '#00E5FF')) dot.classList.add('active');
                    
                    dot.onclick = () => { 
                        if (num === 1) p1Color = color; else p2Color = color;
                        document.documentElement.style.setProperty(`--p${num}-color`, color);
                        container.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
                        dot.classList.add('active');
                    };
                    container.appendChild(dot);
                });
            });
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(() => {});
                document.getElementById('fullscreen-btn').innerText = "Выйти из режима";
            } else {
                document.exitFullscreen();
                document.getElementById('fullscreen-btn').innerText = "На весь экран";
            }
        }

        slider.addEventListener('input', (e) => { clicksDisplay.innerText = e.target.value; });

        function startGame() {
            document.getElementById('label1').innerText = document.getElementById('name1').value || "Игрок 1";
            document.getElementById('label2').innerText = document.getElementById('name2').value || "Игрок 2";
            toggleLabelsPreview();

            shiftPower = 50 / (parseInt(slider.value) || 20);
            p1Width = 50;
            updateLayout();

            document.getElementById('settings-overlay').style.display = 'none';
            document.getElementById('exit-btn').style.display = 'block';
            gameActive = true;
        }

        function handlePress(player) {
            if (!gameActive) return;
            p1Width += (player === 1 ? shiftPower : -shiftPower);
            p1Width = Math.max(0, Math.min(100, p1Width));
            updateLayout();
            checkWin();
        }

        function updateLayout() {
            document.getElementById('player1').style.width = p1Width + '%';
            document.getElementById('player2').style.width = (100 - p1Width) + '%';
        }

        function checkWin() {
            if (p1Width >= 100) endGame(1);
            if (p1Width <= 0) endGame(2);
        }

        function endGame(playerNum) {
            gameActive = false;
            const winnerName = document.getElementById(`name${playerNum}`).value || `Игрок ${playerNum}`;
            const winnerColor = playerNum === 1 ? p1Color : p2Color;
            
            const screen = document.getElementById('victory-screen');
            screen.style.backgroundColor = winnerColor;
            
            // Расчет контрастности текста
            const contrast = getContrastYIQ(rgbToHex(winnerColor));
            screen.style.color = contrast;
            
            document.getElementById('winner-text').innerText = `${winnerName} ВЫИГРАЛ!`;
            document.getElementById('exit-btn').style.display = 'none';
            screen.style.display = 'flex';
        }

        function getContrastYIQ(hexcolor){
            hexcolor = hexcolor.replace("#", "");
            if (hexcolor.length === 3) hexcolor = hexcolor.split('').map(c => c + c).join('');
            const r = parseInt(hexcolor.substr(0,2),16);
            const g = parseInt(hexcolor.substr(2,2),16);
            const b = parseInt(hexcolor.substr(4,2),16);
            const yiq = ((r*299)+(g*587)+(b*114))/1000;
            return (yiq >= 128) ? 'black' : 'white';
        }

        function rgbToHex(rgb) {
            if (rgb.startsWith('#')) return rgb;
            const parts = rgb.match(/\d+/g);
            return "#" + parts.map(x => {
                const hex = parseInt(x).toString(16);
                return hex.length === 1 ? "0" + hex : hex;
            }).join("");
        }

        function resetGame() {
            gameActive = false;
            p1Width = 50;
            updateLayout();
            document.getElementById('victory-screen').style.display = 'none';
            document.getElementById('exit-btn').style.display = 'none';
            document.getElementById('settings-overlay').style.display = 'block';
        }

        const touchHandler = (p) => (e) => { if(e.cancelable) e.preventDefault(); handlePress(p); };
        document.getElementById('player1').addEventListener('touchstart', touchHandler(1), {passive: false});
        document.getElementById('player2').addEventListener('touchstart', touchHandler(2), {passive: false});

        setupPresets();
    </script>
</body>
</html>
